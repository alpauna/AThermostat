<html><head><title>Pins - AThermostat</title>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<link rel='stylesheet' href='/theme.css'>
<script>document.documentElement.dataset.theme=localStorage.getItem('hp-theme')||'dark'</script>
<style>
body{font-family:Arial,sans-serif;margin:0;padding:0;background:var(--bg);}
nav{background:var(--nav-bg);padding:10px 20px;display:flex;align-items:center;gap:18px;}
nav a{color:#fff;text-decoration:none;font-size:14px;padding:6px 12px;border-radius:4px;}
nav a:hover,nav a.active{background:#4CAF50;}
nav .brand{font-weight:bold;font-size:16px;margin-right:auto;color:#fff;}
.content{max-width:700px;margin:20px auto;padding:0 20px;}
h1{color:var(--text);}
.card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:15px;margin-bottom:15px;}
.card h3{margin-top:0;color:#4CAF50;}
table{width:100%;border-collapse:collapse;}
th,td{text-align:left;padding:8px 12px;border-bottom:1px solid var(--border-light);font-size:14px;}
th{color:var(--text-secondary);font-weight:normal;}
td{color:var(--text);}
.on{color:#4CAF50;font-weight:bold;}
.off{color:var(--text-muted);}
.protected{color:#ff9800;}
.strapping{color:#f44336;}
.footer{text-align:center;color:var(--text-muted);font-size:12px;margin-top:10px;}
</style></head><body>
<nav><span class='brand'>AThermostat</span>
<button class='hamburger' onclick='this.nextElementSibling.classList.toggle("open")'><span></span><span></span><span></span></button>
<div class='nav-links'>
<a href='/dashboard'>Dashboard</a>
<a href='/pins' class='active'>Pins</a>
<a href='/config'>Config</a>
<a href='/update'>Update</a>
<a href='/log/view'>Log</a>
<a href='/heap/view'>Heap</a>
<a href='#' class='reboot' onclick="if(confirm('Reboot device?')){var x=new XMLHttpRequest();x.open('POST','/reboot');x.onload=function(){alert(x.status===200?'Rebooting...':'Failed')};x.send()};return false">Reboot</a>
</div></nav>
<div class='content'>
<h1>Pins</h1>
<div class='card'>
<h3>Outputs (Relays)</h3>
<table>
<tr><th>Name</th><th>GPIO</th><th>State</th></tr>
<tbody id='outTable'><tr><td colspan='3'>Loading...</td></tr></tbody>
</table>
</div>
<div class='card'>
<h3>Inputs</h3>
<table>
<tr><th>Name</th><th>GPIO</th><th>State</th></tr>
<tbody id='inTable'><tr><td colspan='3'>Loading...</td></tr></tbody>
</table>
</div>
<div class='card'>
<h3>Protected Pins (ESP32-S3)</h3>
<table>
<tr><th>GPIO</th><th>Function</th><th>Notes</th></tr>
<tr><td>0</td><td class='strapping'>Strapping</td><td>Boot mode select — do not use</td></tr>
<tr><td>3</td><td class='strapping'>Strapping</td><td>JTAG signal source select</td></tr>
<tr><td>19</td><td class='protected'>USB</td><td>USB_D- (USB-JTAG) — used for HX710 #1 DOUT</td></tr>
<tr><td>20</td><td class='protected'>USB</td><td>USB_D+ (USB-JTAG) — used for HX710 #1 CLK</td></tr>
<tr><td>26</td><td class='protected'>SPI Flash</td><td>Connected to SPI flash — do not use</td></tr>
<tr><td>27</td><td class='protected'>SPI Flash</td><td>Connected to SPI flash — do not use</td></tr>
<tr><td>28</td><td class='protected'>SPI Flash</td><td>Connected to SPI flash — do not use</td></tr>
<tr><td>29</td><td class='protected'>SPI Flash</td><td>Connected to SPI flash — do not use</td></tr>
<tr><td>30</td><td class='protected'>SPI Flash</td><td>Connected to SPI flash — do not use</td></tr>
<tr><td>31</td><td class='protected'>SPI Flash</td><td>Connected to SPI flash — do not use</td></tr>
<tr><td>32</td><td class='protected'>SPI Flash</td><td>Connected to SPI flash — do not use</td></tr>
<tr><td>33</td><td class='protected'>PSRAM</td><td>Octal PSRAM — do not use</td></tr>
<tr><td>34</td><td class='protected'>PSRAM</td><td>Octal PSRAM — do not use</td></tr>
<tr><td>35</td><td class='protected'>PSRAM</td><td>Octal PSRAM — do not use</td></tr>
<tr><td>36</td><td class='protected'>PSRAM</td><td>Octal PSRAM — do not use</td></tr>
<tr><td>37</td><td class='protected'>PSRAM</td><td>Octal PSRAM — do not use</td></tr>
<tr><td>43</td><td class='protected'>UART</td><td>U0TXD — serial TX</td></tr>
<tr><td>44</td><td class='protected'>UART</td><td>U0RXD — serial RX</td></tr>
<tr><td>45</td><td class='strapping'>Strapping</td><td>VDD_SPI voltage — used for out_temp_ok input</td></tr>
<tr><td>46</td><td class='strapping'>Strapping</td><td>Boot mode / ROM log output</td></tr>
</table>
</div>
<div id='footer' class='footer'></div>
</div>
<script>
function load(){
  var xhr=new XMLHttpRequest();
  xhr.open('GET','/api/pins',true);
  xhr.onload=function(){
    if(xhr.status===200){
      try{
        var d=JSON.parse(xhr.responseText);
        var oHtml='';
        if(d.outputs){
          for(var i=0;i<d.outputs.length;i++){
            var o=d.outputs[i];
            oHtml+="<tr><td>"+o.name+"</td><td>"+o.boardPin+"</td><td class='"+(o.on?'on':'off')+"'>"+(o.on?'ON':'OFF')+"</td></tr>";
          }
        }
        document.getElementById('outTable').innerHTML=oHtml||'<tr><td colspan="3">No outputs</td></tr>';
        var iHtml='';
        if(d.inputs){
          for(var i=0;i<d.inputs.length;i++){
            var inp=d.inputs[i];
            iHtml+="<tr><td>"+inp.name+"</td><td>"+inp.boardPin+"</td><td class='"+(inp.active?'on':'off')+"'>"+(inp.active?'ACTIVE':'INACTIVE')+"</td></tr>";
          }
        }
        document.getElementById('inTable').innerHTML=iHtml||'<tr><td colspan="3">No inputs</td></tr>';
        document.getElementById('footer').textContent='Updated: '+new Date().toLocaleTimeString();
      }catch(e){}
    }
  };
  xhr.send();
}
load();
setInterval(load,2000);
fetch('/theme').then(function(r){return r.json()}).then(function(d){var t=d.theme||'dark';document.documentElement.dataset.theme=t;localStorage.setItem('hp-theme',t);if(d.systemName){var b=document.querySelector('.brand');if(b)b.textContent=d.systemName;document.title=document.title.replace('AThermostat',d.systemName);}}).catch(function(){});
</script>
<div class="btt" id="btt" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="Back to top">&#9650;</div>
<script>window.addEventListener('scroll',function(){document.getElementById('btt').classList.toggle('show',window.scrollY>300)});</script>
</body></html>
