<html><head><title>Dashboard - AThermostat</title>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<link rel='stylesheet' href='/theme.css'>
<script>document.documentElement.dataset.theme=localStorage.getItem('hp-theme')||'dark'</script>
<style>
body{font-family:Arial,sans-serif;margin:0;padding:0;background:var(--bg);}
nav{background:var(--nav-bg);padding:10px 20px;display:flex;align-items:center;gap:18px;}
nav a{color:#fff;text-decoration:none;font-size:14px;padding:6px 12px;border-radius:4px;}
nav a:hover,nav a.active{background:#4CAF50;}
nav .brand{font-weight:bold;font-size:16px;margin-right:auto;color:#fff;}
.content{max-width:700px;margin:20px auto;padding:0 20px;}
h1{color:var(--text);}
.card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:15px;margin-bottom:15px;}
.card h3{margin-top:0;color:#4CAF50;}
.row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border-light);}
.row:last-child{border-bottom:none;}
.row .lbl{color:var(--text-secondary);font-size:14px;}
.row .val{font-weight:bold;color:var(--text);font-size:14px;}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0;}
.controls button{padding:8px 16px;border:1px solid var(--border);border-radius:4px;background:var(--surface);color:var(--text);cursor:pointer;font-size:13px;}
.controls button:hover{background:var(--hover-bg);}
.controls button.active{background:#4CAF50;color:#fff;border-color:#4CAF50;}
.setpoint{display:flex;align-items:center;gap:10px;margin:8px 0;}
.setpoint input{width:70px;padding:6px;border:1px solid var(--input-border);border-radius:4px;background:var(--input-bg);color:var(--text);font-size:14px;text-align:center;}
.setpoint button{padding:6px 12px;background:#4CAF50;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:13px;}
.setpoint button:hover{background:#45a049;}
.io-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;}
.io-item{text-align:center;padding:6px;border-radius:4px;font-size:12px;border:1px solid var(--border);}
.io-item.on{background:#4CAF50;color:#fff;border-color:#4CAF50;}
.io-item.off{background:var(--surface);color:var(--text-muted);}
.toggle{display:flex;gap:8px;align-items:center;margin:4px 0;}
.toggle label{color:var(--text-secondary);font-size:14px;min-width:120px;}
.footer{text-align:center;color:var(--text-muted);font-size:12px;margin-top:10px;}
</style></head><body>
<nav><span class='brand'>AThermostat</span>
<button class='hamburger' onclick='this.nextElementSibling.classList.toggle("open")'><span></span><span></span><span></span></button>
<div class='nav-links'>
<a href='/dashboard' class='active'>Dashboard</a>
<a href='/pins'>Pins</a>
<a href='/config'>Config</a>
<a href='/update'>Update</a>
<a href='/log/view'>Log</a>
<a href='/heap/view'>Heap</a>
<a href='#' class='reboot' onclick="if(confirm('Reboot device?')){var x=new XMLHttpRequest();x.open('POST','/reboot');x.onload=function(){alert(x.status===200?'Rebooting...':'Failed')};x.send()};return false">Reboot</a>
</div></nav>
<div class='content'>
<h1>Dashboard</h1>

<div class='card'>
<h3>Temperature</h3>
<div class='row'><span class='lbl'>Current</span><span class='val' id='curTemp'>--</span></div>
<div class='row'><span class='lbl'>Heat Setpoint</span><span class='val' id='heatSP'>--</span></div>
<div class='row'><span class='lbl'>Cool Setpoint</span><span class='val' id='coolSP'>--</span></div>
<div class='setpoint'>
<label style='color:var(--text-secondary);font-size:14px'>Heat:</label>
<input type='number' id='heatIn' step='0.5' min='50' max='90'>
<label style='color:var(--text-secondary);font-size:14px'>Cool:</label>
<input type='number' id='coolIn' step='0.5' min='60' max='95'>
<button onclick='setSetpoints()'>Set</button>
</div>
</div>

<div class='card'>
<h3>State</h3>
<div class='row'><span class='lbl'>Mode</span><span class='val' id='mode'>--</span></div>
<div class='row'><span class='lbl'>Action</span><span class='val' id='action'>--</span></div>
<div class='row'><span class='lbl'>Heat Level</span><span class='val' id='heatLvl'>--</span></div>
<div class='row'><span class='lbl'>Cool Level</span><span class='val' id='coolLvl'>--</span></div>
<div class='row'><span class='lbl'>Defrost</span><span class='val' id='defrost'>--</span></div>
<div class='controls' id='modeButtons'>
<button onclick='setMode("off")'>OFF</button>
<button onclick='setMode("heat")'>HEAT</button>
<button onclick='setMode("cool")'>COOL</button>
<button onclick='setMode("heat_cool")'>AUTO</button>
<button onclick='setMode("fan_only")'>FAN</button>
</div>
</div>

<div class='card'>
<h3>Flags</h3>
<div class='toggle'><label>Force No HP</label><input type='checkbox' id='forceNoHP' onchange='toggleForceNoHP()'></div>
<div class='toggle'><label>Force Furnace</label><input type='checkbox' id='forceFurnace' onchange='toggleForceFurnace()'></div>
</div>

<div class='card'>
<h3>Pressure (inWC)</h3>
<div class='row'><span class='lbl'>Sensor 1</span><span class='val' id='p1'>--</span></div>
<div class='row'><span class='lbl'>Sensor 2</span><span class='val' id='p2'>--</span></div>
</div>

<div class='card'>
<h3>Outputs</h3>
<div class='io-grid' id='outputs'></div>
</div>

<div class='card'>
<h3>Inputs</h3>
<div class='io-grid' id='inputs'></div>
</div>

<div class='card'>
<h3>System</h3>
<div class='row'><span class='lbl'>Uptime</span><span class='val' id='uptime'>--</span></div>
<div class='row'><span class='lbl'>WiFi IP</span><span class='val' id='wifiIP'>--</span></div>
<div class='row'><span class='lbl'>Build</span><span class='val' id='build'>--</span></div>
</div>

<div id='footer' class='footer'></div>
</div>
<script>
var pollInterval=2000;
function fmtUptime(s){var d=Math.floor(s/86400),h=Math.floor(s%86400/3600),m=Math.floor(s%3600/60);return (d>0?d+'d ':'')+(h>0?h+'h ':'')+(m>0?m+'m ':'')+(s%60)+'s';}
function load(){
  var x=new XMLHttpRequest();
  x.open('GET','/api/status',true);
  x.onload=function(){
    if(x.status!==200)return;
    try{
      var d=JSON.parse(x.responseText);
      document.getElementById('curTemp').textContent=d.current_temp!==null?d.current_temp+' F':'N/A';
      document.getElementById('heatSP').textContent=d.heat_setpoint+' F';
      document.getElementById('coolSP').textContent=d.cool_setpoint+' F';
      document.getElementById('mode').textContent=d.mode.toUpperCase();
      document.getElementById('action').textContent=d.action.toUpperCase();
      document.getElementById('heatLvl').textContent=d.heat_level;
      document.getElementById('coolLvl').textContent=d.cool_level;
      document.getElementById('defrost').textContent=d.defrost?'ACTIVE':'No';
      document.getElementById('forceNoHP').checked=d.force_no_hp;
      document.getElementById('forceFurnace').checked=d.force_furnace;
      document.getElementById('p1').textContent=d.pressure1!==undefined?d.pressure1:'--';
      document.getElementById('p2').textContent=d.pressure2!==undefined?d.pressure2:'--';
      document.getElementById('uptime').textContent=fmtUptime(d.uptime);
      document.getElementById('wifiIP').textContent=d.wifi_ip;
      document.getElementById('build').textContent=d.build;
      // Mode buttons
      var btns=document.getElementById('modeButtons').children;
      for(var i=0;i<btns.length;i++){btns[i].classList.remove('active');}
      var modeMap={off:0,heat:1,cool:2,heat_cool:3,fan_only:4};
      if(modeMap[d.mode]!==undefined&&btns[modeMap[d.mode]])btns[modeMap[d.mode]].classList.add('active');
      // Outputs
      var oHtml='';
      if(d.outputs){for(var k in d.outputs){oHtml+="<div class='io-item "+(d.outputs[k]?'on':'off')+"'>"+k+"</div>";}}
      document.getElementById('outputs').innerHTML=oHtml;
      // Inputs
      var iHtml='';
      if(d.inputs){for(var k in d.inputs){iHtml+="<div class='io-item "+(d.inputs[k]?'on':'off')+"'>"+k+"</div>";}}
      document.getElementById('inputs').innerHTML=iHtml;
      // Setpoint inputs
      if(!document.getElementById('heatIn').value)document.getElementById('heatIn').value=d.heat_setpoint;
      if(!document.getElementById('coolIn').value)document.getElementById('coolIn').value=d.cool_setpoint;
      document.getElementById('footer').textContent='Updated: '+new Date().toLocaleTimeString();
    }catch(e){}
  };
  x.send();
}
function setMode(m){
  fetch('/api/mode',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:m})}).then(load);
}
function setSetpoints(){
  var h=parseFloat(document.getElementById('heatIn').value);
  var c=parseFloat(document.getElementById('coolIn').value);
  var body={};
  if(!isNaN(h))body.heat=h;
  if(!isNaN(c))body.cool=c;
  fetch('/api/setpoint',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}).then(load);
}
function toggleForceNoHP(){
  var v=document.getElementById('forceNoHP').checked;
  fetch('/api/force_no_hp',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({enabled:v})});
}
function toggleForceFurnace(){
  var v=document.getElementById('forceFurnace').checked;
  fetch('/api/force_furnace',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({enabled:v})});
}
load();
setInterval(load,pollInterval);
fetch('/theme').then(function(r){return r.json()}).then(function(d){
  var t=d.theme||'dark';document.documentElement.dataset.theme=t;localStorage.setItem('hp-theme',t);
  if(d.systemName){var b=document.querySelector('.brand');if(b)b.textContent=d.systemName;document.title=document.title.replace('AThermostat',d.systemName);}
  if(d.pollInterval)pollInterval=d.pollInterval*1000;
}).catch(function(){});
</script>
<div class="btt" id="btt" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="Back to top">&#9650;</div>
<script>window.addEventListener('scroll',function(){document.getElementById('btt').classList.toggle('show',window.scrollY>300)});</script>
</body></html>
